{% extends 'base.html' %}
{% load static %}
{% block title %}
    {{ user.username }}的个人资料
{% endblock %}

{% block css %}
    <link rel="stylesheet" href="{% static 'css/center.css' %}">
    <script type="text/javascript" src="{% static 'js/center.js' %}"></script>
{% endblock %}
{% block content %}

    <div class="container">
        {#弹出完善信息层#}
        <div class="other-info" id="other_info">
            <div class="top-close">
                完善信息
                <span class="cls" id="cls">关闭</span>
            </div>
            {#  完善信息主体部分      #}
            <div class="info-con">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <ul class="ulist">
                        <li>
                            <span>昵称</span>：&nbsp;&nbsp;&nbsp;<input name="nick" type="text" placeholder="输入昵称"
                                                                     value="{{ user.nick_name }}">
                        </li>
                        <li>
                            <span>出生日期</span>：&nbsp;&nbsp;&nbsp;<input name="birthday" type="date"
                                                                       value="{{ user.birthday }}">
                        </li>
                        <script>
                            console.log("{{ user.birthday |date:'Y-m-d' }}");
                        </script>
                        <li>
                            <span>性别</span>：&nbsp;&nbsp;&nbsp;
                            <label> <input id="man" name="gender" type="radio" value="1"> 男</label>
                            &nbsp;&nbsp;&nbsp;<label><input id="female" name="gender" type="radio" value="0"> 女</label>
                        </li>
                        <li>
                            <span>联系地址</span>：&nbsp;&nbsp;&nbsp;<input name="address" type="text"
                                                                       value="{{ user.address }}">
                        </li>
                        <li>
                            <span>手机号</span>：&nbsp;&nbsp;&nbsp;<input name="mobile" type="number"
                                                                      value="{{ user.mobile }}">
                        </li>
                        <li>
                            <span>头像</span>：&nbsp;&nbsp;&nbsp;<input name="heads" type="file">
                        </li>
                        <li>
                            <input type="submit" class="info-sub btn btn-primary" value="提交">
                            <input type="reset" class="info-sub btn btn-default" value="重置">
                        </li>
                    </ul>

                </form>
            </div>
            {#性别处理#}
            <script>
                $(function () {
                    {% ifequal user.gender '1' %}
                        $("#man").attr('checked', 'checked');
                    {% else %}
                        $("#female").attr('checked', 'checked');
                    {% endifequal  %}
                });
            </script>
        </div>
        <h4 class="tag">基本信息：
            {#判断当前登录用户是否与被浏览的用户一致#}
            {% ifequal request.user.username user.username %}
                <button id="information" class="btn info">完善资料</button>
            {% endifequal %}
        </h4>
        <ul class="user">
            <li>
                <span>昵称</span>：&nbsp;&nbsp;&nbsp;{{ user.nick_name }}
            </li>
            <li>
                <span>用户名</span>：&nbsp;&nbsp;&nbsp;{{ user.username }}
            </li>
            <li>
                <span>邮箱</span>：&nbsp;&nbsp;&nbsp;{{ user.email }}
            </li>
            <li>
                <span>上次登录</span>：&nbsp;&nbsp;&nbsp;{{ user.last_login |date:"Y-m-d H:i:s" }}
            </li>
        </ul>
        <h4 class="tag">常用的标签：</h4>
        <ul class="tags">

            {% if not mark %}
                还没有选择过标签哦
            {% else %}
                {% for key,v in mark.items %}
                    <li class="mk"><a href="{% url 'myblog:mark' user.username key %}">{{ key }}({{ v }})</a></li>
                {% endfor %}
            {% endif %}
        </ul>
        <div class="blog-box">
            <h4 class="tag">发布的博客：</h4>
            <ul class="blogs">
                {% if not blogs %}
                    {% ifequal user.username request.user.username %}
                        <p>没发表过博客？<a href="{% url 'myblog:mdeditor' %}">快来写写</a></p>
                    {% else %}
                        Ta还没有博客哦
                    {% endifequal %}

                {% else %}
                    {% for blog in blogs %}
                        <li><h4>
                            {% if blog.tops %}
                                <span></span>
                            {% endif %}
                            <a class="oneline" href="{% url 'blog:blog_page' blog.id %}">{{ blog.title }}</a></h4>
                            <p class="blog-content">{{ blog.content }}</p>

                            <span class="time"> {{ blog.utime|date:"Y-m-d H:i:s" }}</span> &nbsp;&nbsp;
                            <span>阅读数：{{ blog.rcount }}</span>&nbsp;&nbsp;
                            <span>评论数：{{ blog.coms }}</span>
                        </li>
                    {% endfor %}
                {% endif %}
            </ul>
            {#分页#}
            <ul class="pagination page-center" id="pager">
                <li class="previous"><a href="?page=1">首页</a></li>
                {#上一页按钮开始#}
                {# 如果当前页有上一页#}
                {% if blogs.has_previous %}
                    {#  当前页的上一页按钮正常使用#}
                    <li class="previous"><a href="?page={{ blogs.previous_page_number }}">上一页</a></li>
                {% else %}
                    {# 当前页的不存在上一页时,上一页的按钮不可用#}
                    <li class="previous disabled"><a href="javascript:void(0);">上一页</a></li>
                {% endif %}
                {#上一页按钮结束#}
                <li>
                    <input type="text" id="gotoPage" class="form-control pull-left" placeholder="{{ currentPage }}"
                           onkeyup="this.value=this.value.replace(/\D/g,'')"
                           style="width: 80px; display: inline-block; text-align: center;">
                    <a id="pageBtn" class="btn btn-default" href="javascript:void(0);" style="margin-left: 0;">GO</a>
                    <script>
                        $(document).ready(function () {
                            {#搜索的#}
                            // 我的博客，分页
                            $('#pageBtn').click(function () {
                                var nu = $("#gotoPage").val();
                                {#alert('{{ arg_urls }}');#}
                                if (nu < 1) {
                                    nu = 1
                                }
                                if (nu >{{ paginator.num_pages }}) {
                                    nu = '{{ paginator.num_pages }}';
                                }
                                $(this).attr('href', '?page=' + nu);
                            });
                        });
                    </script>
                </li>
                {# 下一页按钮开始#}
                {% if blogs.has_next %}
                    <li class="next"><a href="?page={{ blogs.next_page_number }}">下一页</a></li>
                {% else %}
                    <li class="next disabled"><a href="javascript:void(0);">下一页</a></li>
                {% endif %}
                {# 下一页按钮结束#}
                <li class="previous"><a href="?page={{ paginator.num_pages }}">尾页</a></li>
                <li class="counts"> 共{{ paginator.num_pages }}页，当前第{{ currentPage }}页</li>

            </ul>
        </div>
    </div>

{% endblock %}